<main class="px-6 pb-6">
  <h1 class="text-3xl font-bold mb-4">เกมทั้งหมด</h1>

  <!-- Filter / Search -->
  <div class="flex flex-wrap items-center justify-between gap-4 mb-6">
    <div class="flex flex-1 items-center gap-3">
      <p-select
        [(ngModel)]="selectedCategory"
        [options]="gameCategories"
        placeholder="ทั้งหมด"
        optionLabel="label"
        class="min-w-[150px]"
      />
      <p-floatlabel variant="on" class="flex-1 max-w-md">
        <p-iconfield>
          <p-inputicon class="pi pi-search" />
          <input pInputText id="search-game" class="w-full" />
          <label for="search-game">ค้นหาเกม</label>
        </p-iconfield>
      </p-floatlabel>
      <p-button label="ค้นหา" icon="pi pi-search" />
    </div>
    <div>
      <p-button routerLink="/dashboard/game/add" label="เพิ่มเกม" icon="pi pi-plus" />
    </div>
  </div>

  <!-- Loading State -->
  @if (isLoading) {
  <div class="flex justify-center items-center py-12">
    <i class="pi pi-spin pi-spinner" style="font-size: 2rem"></i>
    <span class="ml-2">กำลังโหลด...</span>
  </div>
  }

  <!-- Empty State -->
  @else if (games.length === 0) {
  <div class="text-center py-12">
    <i class="pi pi-inbox" style="font-size: 3rem; color: var(--p-text-muted-color)"></i>
    <p class="text-lg mt-4" style="color: var(--p-text-muted-color)">ยังไม่มีเกมในระบบ</p>
    <p-button routerLink="/dashboard/game/add" label="เพิ่มเกมแรก" icon="pi pi-plus" class="mt-4" />
  </div>
  }

  <!-- Game List -->
  @else {
  <div class="grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3">
    @for (game of games; track game.id) {
    <p-card class="rounded-2xl overflow-hidden">
      <ng-template #header>
        <img
          alt="{{ game.title }}"
          class="w-full h-56 object-cover"
          [src]="endpoint + game.imageUrl"
          (error)="$event.target.src = '/1401549.jpg'"
        />
      </ng-template>
      <ng-template #title> {{ game.title }} </ng-template>
      <ng-template #subtitle>
        <div class="flex flex-col">
          <p>ราคา {{ game.price | number : '1.0-0' }} บาท</p>
          <p>วางขายเมื่อวันที่ {{ game.releaseDate | thaiDate : 'datetime' }}</p>
        </div>
      </ng-template>
      <ng-template #content>
        <div class="h-fit sm:h-40 xl:h-32 transition-all duration-300">
          <div class="flex flex-wrap gap-1 mb-3">
            @for (category of game.categories; track category.id) {
            <p-chip [label]="category.name" class="text-xs" />
            }
          </div>
          <p class="text-sm line-clamp-2">{{ game.description }}</p>
        </div>
      </ng-template>
      <ng-template #footer>
        <div class="flex gap-2 mt-3">
          <p-button icon="pi pi-pencil" label="แก้ไข" class="flex-1" styleClass="w-full" />
          <p-button
            icon="pi pi-trash"
            severity="danger"
            class="flex items-center justify-center [&_span]:text-white"
            (onClick)="confirmDelete(game)"
          />
        </div>
      </ng-template>
    </p-card>
    }
  </div>
  }
</main>

<p-toast />
<p-confirmdialog />
