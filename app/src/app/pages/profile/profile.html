<app-user-navigation-bar [position]="'static'"></app-user-navigation-bar>
<main class="px-4">
  <h1 class="text-2xl font-bold">โปรไฟล์ของฉัน</h1>
  <div class="grid grid-cols-[25%_auto] gap-4 mt-2">
    <div class="space-y-3">
      <p-card class="overflow-hidden">
        <ng-template #header>
          <div class="flex justify-center rounded-full overflow-hidden h-1/3 w-1/3 mx-auto mt-3">
            <img alt="Card" [src]="'http://localhost:5053' + currentUser?.profileImage" />
          </div>
        </ng-template>
        <div class="text-center">
          <h3 class="text-xl font-semibold">{{ currentUser?.username }}</h3>
          <p class="text-sm text-muted-color">{{ currentUser?.email }}</p>
        </div>
        <h2 class="text-xl text-center mt-2">
          ยอดเงินคงเหลือ {{ currentUser?.walletBalance }} บาท
        </h2>
        <div class="flex mt-2">
          <p-button
            icon="pi pi-pencil"
            label="แก้ไขโปรไฟล์"
            class="flex-1"
            styleClass="w-full"
            routerLink="/profile/edit"
          />
        </div>
      </p-card>

      <p-card header="เติมเงินเข้ากระเป๋า">
        <p>เลือกจำนวนเงินที่ต้องการเติม</p>
        <div class="grid grid-cols-3 gap-2 mt-2">
          <p-button
            label="100"
            class="w-full"
            styleClass="w-full"
            [variant]="selectedAmount === 100 ? undefined : 'outlined'"
            [severity]="selectedAmount === 100 ? 'primary' : 'secondary'"
            (click)="selectAmount(100)"
          />
          <p-button
            label="200"
            class="w-full"
            styleClass="w-full"
            [variant]="selectedAmount === 200 ? undefined : 'outlined'"
            [severity]="selectedAmount === 200 ? 'primary' : 'secondary'"
            (click)="selectAmount(200)"
          />
          <p-button
            label="500"
            class="w-full"
            styleClass="w-full"
            [variant]="selectedAmount === 500 ? undefined : 'outlined'"
            [severity]="selectedAmount === 500 ? 'primary' : 'secondary'"
            (click)="selectAmount(500)"
          />
        </div>
        <p-icon-field class="my-2 w-full">
          <p-inputicon class="pi pi-wallet" />
          <p-inputnumber
            class="w-full"
            placeholder="กำหนดเอง"
            [(ngModel)]="customAmount"
            (ngModelChange)="onCustomAmountChange($event)"
            [min]="1"
            [showClear]="true"
          />
        </p-icon-field>

        <p-button
          label="เติมเงิน"
          class="w-full"
          styleClass="w-full"
          (click)="processTopup()"
          [disabled]="!isTopupValid()"
          [severity]="isTopupValid() ? 'primary' : 'secondary'"
        />
      </p-card>
    </div>
    <div>
      <h3 class="text-lg font-semibold">ประวัติการทำรายการ</h3>
      <p-table [value]="transactionHistory" class="rounded-xl overflow-hidden" showGridlines>
        <ng-template #header>
          <tr>
            <th>วันที่</th>
            <th>ประเภท</th>
            <th>คำอธิบาย</th>
            <th>จำนวนเงิน</th>
          </tr>
        </ng-template>
        <ng-template #body let-data>
          <tr>
            <td>{{ data.date | date : 'short' }}</td>
            <td>{{ data.type }}</td>
            <td>{{ data.description }}</td>
            <td>{{ data.amount > 0 ? '+' : '' }}{{ data.amount }} บาท</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
</main>
